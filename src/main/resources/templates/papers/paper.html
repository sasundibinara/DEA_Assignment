<!doctype html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8"/>
  <title>Papers</title>
  <link rel="stylesheet" th:href="@{/css/style.css}"/>
</head>
<body>
<h2>Papers</h2>

<!-- üü¢ Upload button -->
<p><a th:href="@{/papers/upload}">+ Upload PDF</a></p>

<!-- üü¢ Filter form (add this section) -->
<form method="get" action="#" style="margin-bottom:1rem;">
  <label>Subject:
    <select name="subjectId">
      <option th:value="''" th:selected="${selectedSubjectId == null}">All</option>
      <option th:each="s : ${subjects}"
              th:value="${s.id}"
              th:text="${s.name}"
              th:selected="${selectedSubjectId != null and selectedSubjectId == s.id}">
      </option>
    </select>
  </label>
  <label>Year:
    <input type="number" name="year" min="2000" max="2100"
           th:value="${selectedYear}">
  </label>
  <button type="submit">Filter</button>
  <a th:href="@{/papers}">Reset</a>
</form>

<!-- üü¢ Table -->
<table border="1" cellpadding="6">
  <thead>
  <tr><th>ID</th><th>Title</th><th>Year</th><th>Type</th><th>Subject</th><th>File</th><th>Actions</th></tr>
  </thead>
  <tbody>
  <tr th:each="p : ${papers}">
    <td th:text="${p.id}"></td>
    <td th:text="${p.title}"></td>
    <td th:text="${p.year}"></td>
    <td th:text="${p.type}"></td>
    <td th:text="${p.subject.name}"></td>
    <td th:text="${p.filePath}"></td>
    <td>
      <a class="btn btn-sm btn-primary" th:href="@{'/papers/' + ${p.id} + '/download'}">Download</a>
      |
      <form th:action="@{'/papers/' + ${p.id} + '/delete'}" method="post" style="display:inline;">
        <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
        <button type="submit">Delete</button>
      </form>
    </td>
  </tr>
  </tbody>
</table>

<div th:if="${totalPages > 1}" style="margin-top: 1rem;">
  <div>
    <span th:text="'Page ' + (${currentPage} + 1) + ' of ' + ${totalPages}"></span>
  </div>

  <div>
    <a th:if="${currentPage > 0}"
       th:href="@{/papers(page=${currentPage - 1}, subjectId=${selectedSubjectId}, year=${selectedYear})}">
      ‚Üê Prev
    </a>

    <span th:each="i : ${#numbers.sequence(0, totalPages - 1)}">
            <a th:if="${i != currentPage}"
               th:href="@{/papers(page=${i}, subjectId=${selectedSubjectId}, year=${selectedYear})}"
               th:text="${i + 1}">1</a>
            <span th:if="${i == currentPage}" th:text="${i + 1}" style="font-weight:bold"></span>
        </span>

    <a th:if="${currentPage < totalPages - 1}"
       th:href="@{/papers(page=${currentPage + 1}, subjectId=${selectedSubjectId}, year=${selectedYear})}">
      Next ‚Üí
    </a>
  </div>
</div>


<p><a th:href="@{/}">‚Üê Home</a></p>
</body>
</html>
